/*! globals 2.8.1 */
import{SeamlessConnection as t,initializeStore as e,PersistentConnection as n,ConnectionExistsError as s,InvalidConnectionNameError as i}from"@seamless/store";import{initializeLogger as o,SeamlessLogger as a}from"@seamless/logger";
/*! connection-aem-meta-tags 2.7.0 */var r,c;!function(t){t.NAME="name",t.PROPERTY="property"}(r||(r={})),function(t){t.META="meta",t.TITLE="title",t.HEAD="head"}(c||(c={}));const u={metaChangeRequests:{}},l="META_TAGS_UPDATE",d=new class extends t{logger;constructor(){super("MBMXP_OWC_META_TAGS_MANAGER"),this.logger=o("OWC FE LIBS META TAGS")}get initialState(){return u}hasRequestPermission(t){const e=window.seamlessRouter?window.seamlessRouter.mainNamespace:null;return e?t===e:(this.logger.warn("router component or the mainNamespace is not defined"),!1)}hasValidMetaAttribute(t){return t.metaValue===c.TITLE||!(!t.metaValue||!t.key)||(this.logger.error("Please provide a valid Meta tag change request"),!1)}metaTagsHandler(t){const e=document.querySelector(c.HEAD);e?t.forEach((t=>{if(!this.hasValidMetaAttribute(t.attribute))return;const n=t.attribute;if(n.metaValue===c.TITLE){const n=document.querySelector(c.TITLE);if(n)n.innerText=t.content;else{const n=document.createElement(c.TITLE);n.innerText=t.content,e.appendChild(n)}}else{const s=document.querySelector(`meta[${n.key}='${t.attribute.metaValue}']`);if(s)s.setAttribute("content",t.content);else{const s=document.createElement(c.META);s.setAttribute(n.key,t.attribute.metaValue),s.setAttribute("content",t.content),e.appendChild(s)}}})):this.logger.log("No head element present, skipping update")}stateHandler(t,e){const n=this.hasRequestPermission(e.payload.routerNamespace);return n&&this.metaTagsHandler(e.payload.metaTagsList),{metaChangeRequests:{...t.metaChangeRequests,[e.payload.routerNamespace]:{metaTags:e.payload.metaTagsList,allowedUpdate:n}}}}getReducer(){return(t=u,e)=>e.type===this.getActionType(l)?this.stateHandler(t,e):t}getPublicDispatchers(){return{updateMetaTags:(t,e)=>{const n=Array.isArray(t)?t:[t];return this.getAction(l,{metaTagsList:n,routerNamespace:e})}}}},h="OWC_AEM_ENV",w=new class extends t{constructor(){super(h)}get initialState(){const t=window.aemNamespace?.environmentVariables||window.top?.aemNamespace?.environmentVariables,e=window.aemNamespace?.pageEnvironmentVariables||window.top?.aemNamespace?.pageEnvironmentVariables;return t&&e?{...t,...e}:{}}getReducer(){return()=>this.initialState}getPublicDispatchers(){return{}}},m=async()=>{const t=e();return await(async()=>{if(!window.top?.aemNamespace&&!window.aemNamespace)return new Promise((t=>{let e;Object.defineProperty(window.top,"aemNamespace",{get:()=>e,async set(n){e=n,t()}})}))})(),await(async()=>{if(!window.top?.aemNamespace?.environmentVariables&&!window?.aemNamespace?.environmentVariables)return new Promise((t=>{let e;Object.defineProperty(window.top?.aemNamespace,"environmentVariables",{get:()=>e,set(n){e=n,t()}})}))})(),await(async()=>{if(!window.top?.aemNamespace?.pageEnvironmentVariables&&!window?.aemNamespace?.pageEnvironmentVariables)return new Promise((t=>{let e;Object.defineProperty(window.top?.aemNamespace,"pageEnvironmentVariables",{get:()=>e,set(n){e=n,t()}})}))})(),t.addConnection(w)
/*! component-registry-connection 2.7.0 */},g={components:{}},p="OWC_COMPONENT_REGISTRY",f="ADD_COMPONENT",b="REMOVE_COMPONENT",y="ADD_COMPONENTS",C=new class extends t{constructor(){super(p)}get initialState(){return g}getReducer(){return(t=g,e)=>{switch(e.type){case this.getActionType(f):return t.components[e.payload.id]=e.payload.data,{...t,components:{...t.components,[e.payload.id]:e.payload.data}};case this.getActionType(y):return{...t,components:{...t.components,...e.payload}};case this.getActionType(b):return delete t.components[e.payload],{...t,components:{...t.components}};default:return t}}}getPublicDispatchers(){return{addComponents:t=>this.getAction(y,t),addComponent:t=>this.getAction(f,t),removeComponent:t=>this.getAction(b,t)}}},O=async()=>{const t=e();return await t.getConnectionDispatchers(p)},S=(t,e)=>{if(t===e)return!0;if("object"!=typeof t||"object"!=typeof e)return!1;const n=Object.keys(t);return n.length===Object.keys(e).length&&n.every((n=>S(t[n],e[n])))};class OwcComponentRegistry{store=e();logger=o("OWC FE LIBS COMPONENT REGISTRY");previousState={};compareStateReference={};componentListeners=new Map;constructor(){this.store.subscribe(p,(t=>{!Object.keys(this.previousState).length&&Object.keys(t.components).length&&(this.compareStateReference=t.components);for(const[e,n]of this.componentListeners){const s=t.components[e];this.hasComponentStateChanged(e,s)&&n.forEach((t=>t(s)))}this.previousState=t.components})),this.initConnection()}async initConnection(){await(async()=>{const t=e();return await t.addConnection(C)})(),await m();const t=await O(),n=window.top||window;n.aemNamespace||(this.logger.warn("window.top?.aemNamespace is not defined, adding an empty Object"),n.aemNamespace={}),n.aemNamespace?.componentData&&t.addComponents(n.aemNamespace.componentData),this.store.subscribe(h,(async e=>{if("AUTHOR"===e.runMode){const{proxy:e}=await import("./author-7ynjAOLG-ev06t5b6.js");e(n.aemNamespace.componentData??{},t)}}))}subscribe(t,e){this.getComponentDataListeners(t).push(e),this.previousState&&t in this.previousState&&e(this.previousState[t])}unsubscribe(t,e){const n=this.getComponentDataListeners(t),s=n.indexOf(e);s>=0&&n.splice(s,1)}getComponentDataListeners(t){let e=this.componentListeners.get(t);return null==e&&(e=[],this.componentListeners.set(t,e)),e}hasComponentStateChanged(t,e){const n=!S(e,this.compareStateReference[t]);return(t&&e&&n||!this.compareStateReference[t])&&(this.compareStateReference[t]=e),n}async addComponents(t){(await O()).addComponents(t)}async addComponent(t){(await O()).addComponent(t)}async removeComponent(t){(await O()).removeComponent(t)}}
/*! router 7.0.0 */
const v=".html",E=["Path"];function A(t,e){const n=t.pathname.lastIndexOf(e);return n>=0?`${t.pathname.substring(0,n+e.length)}/`:"/"}function k(t,e){if(null==t&&null==e)return!0;if(null==t||null==e)return!1;const n=Object.keys(t),s=Object.keys(e);return n.length===s.length&&n.every((n=>t[n]===e[n]))}const L=t=>{try{return decodeURIComponent(t)}catch(e){return t}};function P(t,e,n){const s={};for(const[i,o]of t){const t=L(o);e&&!e(i,t)||(s[n?n(i):i]=t)}return s}function R(){T()}function T(t=!1){const e=M(),n=e.currentUrl,s=new URL(String(window.location));e.currentUrl=s;const i=new Map;e.urlChangeListeners.forEach((e=>{const o=function(t,e,n,s){const i=s.get(t.namespace||null);if(null!=i)return i;if(null==t.namespace){const t={hasChanged:e.href!==n.href,event:{from:{url:e,subPathname:N(e)},to:{url:n,subPathname:N(n)}}};return s.set(null,t),t}const o=_(e,t.namespace),a=_(n,t.namespace),r={hasChanged:o.subPathname!=a.subPathname||!k(o.searchParams,a.searchParams),event:{from:o,to:a}};return s.set(t.namespace,r),r}(e,n,s,i);(o.hasChanged||t)&&e.handler(o.event)}))}function _(t,e){const n=M(),s=N(t,e),i=function(t,e,n){if(null==e)return P(t.searchParams);const s=t=>t.substr(e.length);if(e===n)return P(t.searchParams,(t=>t.startsWith(e)),s);const i=`${e}Path`;return P(t.searchParams,(t=>t.startsWith(e)&&t!=i),s)}(t,e,n.mainNamespace);return{url:t,subPathname:s,searchParams:i}}function N(t,e){const n=M();if(null==e||e===n.mainNamespace)return t.pathname.substring(n.basePathname.length-1)||"/";const s=`${e}Path`;return t.searchParams.get(s)||"/"}function $(){null==window.seamlessRouter&&function(){if(null!=window.seamlessRouter)return;const t=M();t.currentUrl=new URL(String(window.location)),t.basePathname=A(t.currentUrl,v),t.isInitialized=!0,window.addEventListener("popstate",R),window.addEventListener("hashchange",R)}()}function j(t){if("string"!=typeof t)throw new TypeError("[routing] namespace must be a string literal");$();const e=M();if(null!=e.mainNamespace)return void(null!=t&&e.mainNamespace!==t&&console.warn("[sw-routing] refused re-set of main namespace. It can only be set once."));e.mainNamespace=t;const n=`${t}Path`,s=e.currentUrl.searchParams.get(n);if(null!=s&&s.length>0){const i=function(t,e){if($(),!function(t,e){if(null==t||"object"!=typeof t){if(null==e||"object"!=typeof t)return console.warn("[sw-routing] resolve arguments should contain an URLInitOption object or array or an URLGlobalOptions object"),!1}else if(Array.isArray(t)){if(0===t.length)return console.warn("[sw-routing] Namespace options argument must contain at least one URLInitOption object"),!1;if(!t.every((t=>D(t))))return console.warn('[sw-routing] Namespace options must be an object with a "namespace" string property.'),!1}else if(!D(t))return console.warn('[sw-routing] Namespace options must contain a "namespace" string property.'),!1;return!0}(t,e))return null;const{target:n,isSamePage:s}=function(t){const e=M(),n=new URL(String(e.currentUrl));if(!t)return{target:n,isSamePage:!0};return"string"==typeof t.base&&t.base.length>0&&t.base?(n.pathname=t.base,n.search="",n.hash="",{target:n,isSamePage:!1}):t.clear?(n.pathname=e.basePathname,n.search="",n.hash="",{target:n,isSamePage:!0}):{target:n,isSamePage:!0}}(e);return Array.isArray(t)?t.forEach((t=>{U(n,t,s)})):t&&U(n,t,s),n}({namespace:t,path:s,hash:e.currentUrl.hash});null!=i&&(i.searchParams.delete(n),function(t,e=!1,n=!0){$();const s=M(),i=t.href===s.currentUrl.href;!function(t,e,n,s){s?(window.top||window).location.href=t.href:(e?window.history.replaceState({from:"url"},"",t.href):window.history.pushState({from:"url"},"",t.href),n&&T())}(t,e,n&&!i,!function(t){$();const e=M();if("string"==typeof t){if(t.length>0){const n=t.endsWith("/")?t:t+"/";return e.basePathname===n}return!0}if(t instanceof URL){const n=A(t,v);return e.basePathname===n}return!1}(t))}(i,!0,!0))}else T(!0);console.info(`[sw-routing] accepted main namespace ${e.mainNamespace}`)}function M(){const t=window.top||window;return t.seamlessRouter||(t.seamlessRouter={mainNamespace:null,basePathname:"/",urlChangeListeners:[],currentUrl:new URL(String(t.location)),isInitialized:!1}),t.seamlessRouter}function D(t){return"string"==typeof t.namespace}function U(t,e,n){const s=M(),i=e.searchParams,o=e.pathname||e.path;if(o){const i=o.startsWith("/")?o:`/${o}`;if(e.namespace===s.mainNamespace&&n){let e=s.basePathname;s.basePathname.endsWith("/")&&(e=s.basePathname.substring(0,s.basePathname.length-1)),t.pathname=`${e}${i}`}else t.searchParams.set(`${e.namespace}Path`,i)}e.hash&&(t.hash=e.hash),i&&Object.entries(i).forEach((([n,s])=>{if(E.includes(n))return void console.warn(`[sw-routing] Using '${n}' as a search param is not allowed and will be ignored.`);const i=`${e.namespace}${n}`;null==s?t.searchParams.delete(i):t.searchParams.set(i,s)}))}const W=["namespace","path","pathname","hash","search-params"];class RouterViewQuery extends HTMLElement{static get observedAttributes(){return W}constructor(){super(),this.queryOptions={namespace:"",path:"",hash:"",searchParams:{}},this.queryKey=Symbol();const t=document.createElement("style");t.textContent=RouterViewQuery.stylesheet,this.attachShadow({mode:"closed"}).append(t)}attributeChangedCallback(t,e,n){switch(t){case"path":case"pathname":this.queryOptions.path=n;break;case"hash":this.queryOptions.hash=n;break;case"search-params":{const t=n.split("&").map((t=>t.split("="))),e=Object.fromEntries(t);this.queryOptions.searchParams=e;break}case"namespace":this.queryOptions.namespace=n}this.dispatchEvent(new CustomEvent("sw-query-update",{bubbles:!0,detail:{queryOptions:this.queryOptions,key:this.queryKey}}))}}RouterViewQuery.stylesheet="\n    :host {\n      display: none !important;\n    }\n  ","function"==typeof SuppressedError&&SuppressedError;const x=["namespace","path","pathname","hash","search-params"];class RouterLinkTarget extends HTMLElement{static get observedAttributes(){return x}constructor(){super(),this.urlParts={namespace:"",path:"",hash:"",searchParams:{}},this.targetKey=Symbol();const t=document.createElement("style");t.textContent=RouterLinkTarget.stylesheet,this.attachShadow({mode:"closed"}).append(t)}attributeChangedCallback(t,e,n){switch(t){case"path":case"pathname":this.urlParts.path=n;break;case"hash":this.urlParts.hash=n;break;case"search-params":{const t=n.split("&").map((t=>t.split("="))),e=Object.fromEntries(t);this.urlParts.searchParams=e;break}case"namespace":this.urlParts.namespace=n}this.dispatchEvent(new CustomEvent("sw-target-update",{bubbles:!0,detail:{urlParts:this.urlParts,key:this.targetKey}}))}}RouterLinkTarget.stylesheet="\n    :host {\n      display: none !important;\n    }\n  ";
/*! vue-store-plugin 6.1.1 */
var I=function(){return I=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},I.apply(this,arguments)},V=function(){function t(){}return Object.defineProperty(t.prototype,"mixin",{get:function(){return{data:function(){return{store:e()}}}},enumerable:!1,configurable:!0}),t.prototype.install=function(t){return t.mixin(I({},this.mixin))},t}();const G=t=>{const e=window.top.document.querySelector("iframe");if(e){const n=e.contentWindow.vueInstance,s=t.target,i=s.tagName.toLowerCase(),o=n.$options.components[i];if(o){const t=new o({propsData:{componentId:s.getAttribute("component-id"),dataEditMode:s.getAttribute("data-edit-mode")}});t.$mount();s.querySelectorAll(".cq-Editable-dom--container").forEach((e=>{t.$el.prepend(e)})),s.prepend(t.$el)}}},z=window.top||window,B={Authentication:null,Locale:null,Environment:null,DealerContext:null,ConsentList:[],User:null},H="OWC_WKO",J="UPDATE_WKO",K=new class extends t{constructor(){super(H)}get initialState(){return B}getReducer(){return(t=B,e)=>e.type===this.getActionType(J)?{...t,[e.payload.name]:e.payload.value}:t}getPublicDispatchers(){return{setWko:t=>this.getAction(J,t)}}},q=async()=>e().addConnection(K),F=async()=>{const t=e();return await t.getConnectionDispatchers(H)},Q="ow_aem",X={authentication:{jwe:`${Q}_jwe`,jwt:`${Q}_jwt`,token:`${Q}_sub`,roles:`${Q}_roles`},user:{personal:{name:`${Q}_name`,firstname:`${Q}_firstname`,lastname:`${Q}_lastname`,gender:`${Q}_gender`,email:`${Q}_email`,phone:`${Q}_phone`,roles:`${Q}_roles`,wkoUserData:`${Q}_wkoUserData`},associatedVehicles:`${Q}_userAssociatedVehicles`,associatedDealers:`${Q}_userAssociatedDealers`,selectedAssociatedVehicle:`${Q}_selectedAssociatedVehicle`,consent:{dataUsageScopes:`${Q}_dataUsageScopes`,enableDataUsages:`${Q}_enableDataUsages`}}};var Y;!function(t){t.local="local",t.session="session"}(Y||(Y={}));class BrowserStorageUtils{t;loggingEnabled=!1;logger=o("OWC FE LIBS");constructor(t){e().subscribe(h,(t=>{"prod"!==t.stageVariant&&(this.loggingEnabled=!0)})),this.t=t}get storage(){return this.t===Y.local?window.localStorage:window.sessionStorage}async getItem(t){const e=this.storage.getItem(t);if(this.loggingEnabled&&this.logger.log(`${this.t} : getItem : key: ${t}`),null==e)return this.loggingEnabled&&this.logger.warn(`${this.storage} : could not find key: ${t}`),null;try{return JSON.parse(e)}catch{return this.loggingEnabled&&this.logger.warn(`${this.storage} : could not convert "${t}" to JSON, returning it as is`),e}}}const Z="Authentication",tt="Locale",et="Environment",nt="User",st="ConsentList";var it,ot;!function(t){t.SALES="SALES",t.SERVICE="SERVICE"}(it||(it={}));class LoginChecks{sessionStorage=new BrowserStorageUtils("session");wkoManagerDispatchers;user={};authentication={};constructor(){this.init()}async init(){this.wkoManagerDispatchers=await F(),this.initializeLoginchecks()}async getStoredValues(t){const e=Object.keys(t),n=Object.values(t),s=e.reduce((async(t,e,s)=>{const i=await t,o=await this.sessionStorage.getItem(n[s]);return null==o?i:{...i,[e]:o}}),Promise.resolve({}));return await s}async getAuthentication(){return await this.getStoredValues(X.authentication)}async getUserPersonalData(){return await this.getStoredValues(X.user.personal)}async getUserConsent(){return await this.getStoredValues(X.user.consent)}async getSelectedAssociatedVehicle(){return await this.sessionStorage.getItem(X.user.selectedAssociatedVehicle)}async getUserAssociatedVehicles(){return await this.sessionStorage.getItem(X.user.associatedVehicles)}async getUserAssociatedDealers(){return await this.sessionStorage.getItem(X.user.associatedDealers)}getUserSelectedAssociatedDealer(t){const e=t.selectedAssociatedVehicle?.finOrVin;if(t.selectedAssociatedVehicle&&t.userAssociatedDealers&&e){const n=t.userAssociatedDealers[e];if(n)return n.reduce(((t,e)=>(e.dealerType===it.SALES?t.salesDealer=e:e.dealerType===it.SERVICE&&(t.serviceDealer=e),t)),{})}return{}}async getLoginchecksObject(){const t=await Promise.all([this.getAuthentication(),this.getUserPersonalData(),this.getUserAssociatedVehicles(),this.getSelectedAssociatedVehicle(),this.getUserAssociatedDealers(),this.getUserConsent()]);return{authentication:t[0],userPersonalData:t[1],associatedVehicles:t[2],selectedAssociatedVehicle:t[3],userAssociatedDealers:t[4],userConsent:t[5]}}updateStore(t,e){this.wkoManagerDispatchers.setWko({name:t,value:e})}async generateLoginchecksWkos(){const t=await this.getLoginchecksObject(),e=this.getUserSelectedAssociatedDealer(t);this.user={personal:t.userPersonalData,associatedVehicles:t.associatedVehicles,selectedAssociatedVehicle:t.selectedAssociatedVehicle,selectedAssociatedDealer:e,associatedDealers:t.userAssociatedDealers,consent:t.userConsent},this.authentication=t.authentication}async initializeLoginchecks(){this.generateLoginchecksWkos().then((()=>{this.updateStore(Z,this.authentication),this.updateStore(nt,this.user),this.addWkoManagerListener()}))}addWkoManagerListener(){window.addEventListener("wko-manager-update",(async()=>{await this.generateLoginchecksWkos(),this.updateStore(nt,this.user)}))}}!function(t){t.ucEvents="ucEvents",t.ucEventsUpdated="usercentrics-consents-updated",t.ucConsentsLoaded="usercentrics-consents-loaded"}(ot||(ot={}));class ConsentList{wkoManagerConnection;constructor(){this.init(),this.addEventListeners()}async init(){this.wkoManagerConnection=await F()}addEventListeners(){window.addEventListener(ot.ucEventsUpdated,this.consentListener),document.addEventListener(ot.ucConsentsLoaded,this.consentListener,!1)}consentListener=t=>{t.detail&&t.detail.consents&&this.wkoManagerConnection.setWko({name:st,value:t.detail.consents})}}class WKOManager{store=e();allWkos;loginChecks;consentList;constructor(){this.initializeWkoManager()}async initializeWkoManager(){const t=await F();this.store.subscribe(h,(e=>{t.setWko({name:et,value:e}),t.setWko({name:tt,value:{country:e.country,language:e.language}})})),this.store.subscribe(H,(t=>{this.allWkos=t})),this.loginChecks=new LoginChecks,this.consentList=new ConsentList}}
/*! connection-aem-translations 2.7.0 */
const at="PUSH_TRANSLATION_MESSAGE",rt={},ct=new class extends t{constructor(){super("MBMXP_OWC_TRANSLATION_MANAGER")}get initialState(){return rt}getReducer(){return(t,e)=>e.type===this.getActionType(at)?t[e.payload.projectID]?{...t,[e.payload.projectID]:{...t[e.payload.projectID],...e.payload.translation}}:{...t,[e.payload.projectID]:e.payload.translation}:t}getPublicDispatchers(){return{pushTranslationMessage:(t,e)=>this.getAction(at,{projectID:t,translation:e})}}},ut=async()=>e().addConnection(ct)
/*! connection-aem-tracking 2.6.0 */,lt="OWC_TRACKING_MANAGER",dt="PUSH_TRACKING_EVENT",ht={trackingEvents:[]},wt=new class extends t{constructor(){super(lt)}get initialState(){return ht}getReducer(){return(t=ht,e)=>e.type===this.getActionType(dt)?{...t,trackingEvents:[...t.trackingEvents,e.payload]}:t}getPublicDispatchers(){return{pushTrackingEvent:t=>(window.top?.dataLayer_ow.push(t),this.getAction(dt,t))}}},mt=`OWC FE LIBS ${lt}`,gt=async()=>{const t=e();return await(()=>{if(!window.top?.dataLayer_ow)return o(mt).warn("window.dataLayer_ow is not defined, adding empty Object"),new Promise((t=>{let e;Object.defineProperty(window.top,"dataLayer_ow",{get:()=>e,set(n){e=n,t()}})}))})(),t.addConnection(wt)
/*! connection-aem-environment 2.5.0 */},pt="OWC_AEM_ENV";new class extends t{constructor(){super(pt)}get initialState(){const t=window.aemNamespace?.environmentVariables||window.top?.aemNamespace?.environmentVariables,e=window.aemNamespace?.pageEnvironmentVariables||window.top?.aemNamespace?.pageEnvironmentVariables;return t&&e?{...t,...e}:{}}getReducer(){return()=>this.initialState}getPublicDispatchers(){return{}}};
/*! connection-wko-manager 2.5.0 */
const ft={Authentication:null,Locale:null,Environment:null,DealerContext:null,ConsentList:[],User:null},bt="OWC_WKO",yt="UPDATE_WKO";new class extends t{constructor(){super(bt)}get initialState(){return ft}getReducer(){return(t=ft,e)=>e.type===this.getActionType(yt)?{...t,[e.payload.name]:e.payload.value}:t}getPublicDispatchers(){return{setWko:t=>this.getAction(yt,t)}}};var Ct;!function(t){t.local="local",t.session="session"}(Ct||(Ct={}));const Ot="DealerContext";var St,vt;
/*! dealer-context 1.11.0 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function Et(t,e,n,s){return new(n||(n=Promise))((function(i,o){function a(t){try{c(s.next(t))}catch(t){o(t)}}function r(t){try{c(s.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,r)}c((s=s.apply(t,e||[])).next())}))}!function(t){t.SALES="SALES",t.SERVICE="SERVICE"}(St||(St={})),function(t){t.ucEvents="ucEvents",t.ucEventsUpdated="usercentrics-consents-updated",t.ucConsentsLoaded="usercentrics-consents-loaded"}(vt||(vt={}));const At="cscs-token",kt="ow_aem_dealerContext",Lt="preferredDealer";class DealerContext{constructor(){this.config={},this.store=e(),this.applicationName=null,this.generateConfig=t=>{var e;const n="local"!==t.stageVariant?"":"https://test-author.mbmxp.aem.oneweb.mercedes-benz.com";return{dealerContextObject:null===(e=window.aemNamespace)||void 0===e?void 0:e.dealerContext,cscsApiUrl:`${t.apiUri}/cscs/v2/contexts`,applicationName:t.cscsApi.applicationName,aemTokenProxyUrl:n,endpoints:{tokenCreation:""+t.cscsApi.apiPath}}},this.hasContextStored=()=>{const t=this.getStoredObject(kt);return!(!t||!Object.keys(t).length)&&(!(this.config.dealerContextObject&&!this.isContextEqual(t,this.config.dealerContextObject))&&(this.wkoManagerConnection.setWko({name:Ot,value:t}),!0))},this.getAvailableContext=()=>Et(this,void 0,void 0,(function*(){const t=yield window.fetch(this.config.cscsApiUrl,{method:"GET",credentials:"include"});if(204===t.status||!t.json)return;const e=yield t.json();return Object.keys(e).length?e:void 0})),this.getContext=t=>Et(this,void 0,void 0,(function*(){const e=this.getStoredObject(At);if(e){const n=`${this.config.cscsApiUrl}/${Lt}/${t}`,s=yield window.fetch(n,{method:"GET",credentials:"include",headers:{Authorization:""+e.token,applicationName:this.config.applicationName}});if(!s.ok)return;return yield s.json()}})),this.checkAccessToken=()=>Et(this,void 0,void 0,(function*(){const t=this.getStoredObject(At);(!t||t&&this.isTokenExpired(t.expirationDate))&&(yield this.getAccessToken())})),this.storeAvailableContext=t=>Et(this,void 0,void 0,(function*(){const e=yield this.getContext(t.preferredDealer);if(e){if(this.config.dealerContextObject&&!this.isContextEqual(e,this.config.dealerContextObject))return void(yield this.saveDealerInformation(Lt,this.config.dealerContextObject));window.sessionStorage.setItem(kt,JSON.stringify(e)),this.wkoManagerConnection.setWko({name:Ot,value:e})}})),this.getStoredObject=t=>{const e=window.sessionStorage.getItem(t);if(e)return JSON.parse(e)},this.isTokenExpired=t=>{const e=this.convertDateStringToTimeStamp(t);if(e)return e<Date.now()},this.convertDateStringToTimeStamp=t=>{const e=/(\d\d)-(\d\d)-(\d\d\d\d) (\d\d):(\d\d)/.exec(t);if(null!=e){const[,t,n,s,i,o]=e;return new Date(Number(s),Number(n)-1,Number(t),Number(i),Number(o)).getTime()}},this.getAccessToken=()=>Et(this,void 0,void 0,(function*(){const t=`${this.config.aemTokenProxyUrl}${this.config.endpoints.tokenCreation}`,e=yield window.fetch(t,{method:"GET"});if(!e.ok)return;const n=yield e.json();return window.sessionStorage.setItem(At,JSON.stringify(n)),n})),this.saveDealerInformation=(t,e)=>Et(this,void 0,void 0,(function*(){const n=At,s=this.getStoredObject(n);if(s){const n=yield window.fetch(`${this.config.cscsApiUrl}/${t}?ttl=3600000`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:""+s.token,applicationName:this.config.applicationName},body:JSON.stringify(e)});if(!n.ok)return;const i=yield n.json();window.sessionStorage.setItem("dealerContextSession",JSON.stringify(i)),window.sessionStorage.setItem(kt,JSON.stringify(e)),this.wkoManagerConnection.setWko({name:Ot,value:e})}})),this.isContextEqual=(t,e)=>{if(t===e)return!0;if("object"!=typeof t||"object"!=typeof e)return!1;const n=Object.keys(t);return n.length===Object.keys(e).length&&n.every((n=>this.isContextEqual(t[n],e[n])))},this.init=()=>Et(this,void 0,void 0,(function*(){this.hasContextStored()||this.checkAccessToken().then((()=>Et(this,void 0,void 0,(function*(){const t=yield this.getAvailableContext();t?yield this.storeAvailableContext(t):this.config.dealerContextObject&&(yield this.saveDealerInformation(Lt,this.config.dealerContextObject))}))))})),this.store.subscribe(pt,(t=>{this.config=this.generateConfig(t)})),(async()=>{const t=e();return await t.getConnectionDispatchers(bt)})().then((t=>{this.wkoManagerConnection=t,this.init()}))}}const Pt=["AemEnvironment","WkoManager","TranslationManager","Tracking"],Rt=["ComponentRegistry","DealerContext","WkoManager"],Tt=["SeamlessStore","SeamlessLogger"],_t=async t=>{const e=t?.loggerInstance,n=t?.connections?t.connections:Pt;for await(const t of n)switch(t){case"AemEnvironment":await m(),e?.log("added AemEnvironmentConnection");break;case"WkoManager":await q(),e?.log("added ConnectionWkoManager");break;case"TranslationManager":ut().then((()=>{e?.log("added TranslationConnection")}));break;case"Tracking":gt().then((()=>{e?.log("added TrackingReducerConnection")}))}},Nt=t=>{const e=t?.loggerInstance;(t?.packages?t.packages:Rt).forEach((async t=>{switch(t){case"ComponentRegistry":!function(){const t=window.top||window;null==t.owc&&(t.owc={componentRegistry:new OwcComponentRegistry}),null==t.owc.componentRegistry&&(t.owc.componentRegistry=new OwcComponentRegistry),t.owc.componentRegistry}(),e?.log("initialized component registry");break;case"DealerContext":!function(){const t=window.top||window;null==t.dealerContext&&(t.dealerContext=new DealerContext),t.dealerContext}(),e?.log("initialized dealerContext");break;case"WkoManager":!function(){const t=window.top||window;let e=t.owc?.wkoManager;if(null==e&&t.aemNamespace){const n=new WKOManager;t.owc?t.owc.wkoManager=n:t.owc={wkoManager:n},e=t.owc.wkoManager}}(),e?.log("initialized wko manager")}}))},$t=r=>{const c={};let u=["SeamlessStore"];return!r?.namespace&&r?.starters?u=r?.starters.filter((t=>"SeamlessLogger"!==t)):r?.namespace&&(u=r?.starters?r?.starters:Tt),u.forEach((u=>{switch(u){case"SeamlessStore":c.store=((o="prod")=>{const a=()=>!!z?.seamlessStore,r=e(o);return z.seamlessStore||(z.seamlessStore={store:r,initializeStore:e,isStoreAvailable:a,SeamlessConnection:t,PersistentConnection:n,ConnectionExistsError:s,InvalidConnectionNameError:i}),Object.seal(z.seamlessStore),Object.seal(z.seamlessStore.store),z.seamlessStore.store})("prod");break;case"SeamlessLogger":c.logger=r?(t=>{const e=o(t);return z.seamlessLogger||(z.seamlessLogger={seamlessLoggerInstance:new a,initializeLogger:o}),e})(r.namespace):void 0}})),c},jt=t=>`GLOBALS 2.8.1 ${t}`,Mt="2.8.1",{store:Dt,logger:Ut}=$t({namespace:"OWC FE LIBS GLOBALS"});(()=>{if(window.Vue&&window.addEventListener("DOMContentLoaded",(function(){const t=new window.Vue;document.querySelectorAll('[data-integration-type="vuecomponent"]:not([data-vue-version^="3"])').forEach((t=>{new window.Vue({el:t})})),window.vueInstance=t})),"AUTHOR"===window.top?.aemNamespace.pageEnvironmentVariables.runMode){const t=window.top.document.querySelector("iframe");t&&t.contentWindow.document.addEventListener("component-updated",G)}})(),_t({loggerInstance:Ut}).then((()=>(async()=>window.Vue?(window.Vue.use(V),!1):new Error("Vue seems not defined on window"))().catch((t=>Promise.resolve(t))))).then((t=>{t&&Ut.error(t),Nt({loggerInstance:Ut}),Dt&&Dt.subscribe(p,(t=>{if(t.components){Object.keys(t.components).forEach((n=>{const s=t.components[n];s.config&&s.config.routingEnabled&&(Ut.log(jt(`main namespace found ${s.config.routerNamespace}`)),j(s.config.routerNamespace),(async()=>e().addConnection(d))
/*! connection-aem-environment 2.7.0 */().then((()=>Ut.log(jt("added ConnectionMetaTagsManager")))))}))}}))})).catch((t=>Ut.error(t)));export{_t as addStoreConnections,Nt as initializePackages,$t as setupEnvironment,Mt as version};
//# sourceMappingURL=index.js.map
