window.analytics_ow=window.analytics_ow||{},window.analytics_ow.personalisation=window.analytics_ow.personalisation||{},window.analytics_ow.personalisation.func=window.analytics_ow.personalisation.func||{},analytics_ow.personalisation.func.set_shop_pdp_srp_info=(e,t)=>{const a=(e,t)=>{if("undefined"!=typeof Evergage){const a={};if("lastSeenPDP"===e){const e={dcpProductId:t.dcpProductId,dcpProductVehicle:t.dcpProductVehicle,dcpProductClass:t.dcpProductClass,dcpProductbm:t.dcpProductbm};a.lastSeenPDP=JSON.stringify(e),a.lastSeenPDP_image=t.dcpProductImg,a.lastSeenPDP_productLink=t.dcpProductLink}else a[e]="string"==typeof t?t:JSON.stringify(t);Evergage.sendEvent({action:"set_user_attribute",account:{attributes:a}})}},o=()=>{const e=window.analytics_ow.personalisation.func.find_all_by_key(dataLayer_ow,"products"),t=e[e.length-1],o=t.type.includes("COMVANS")?"vans_":"",n=t.articleId,c=Date.now(),l=setInterval((()=>{const e=document.querySelector("emh-product-details")?.shadowRoot;e&&e.querySelector(".wb-360-viewer__image")&&(!function(){const e=document.querySelector("emh-product-details"),l=e.shadowRoot,i=l.querySelector(".wb-360-viewer__image").style.backgroundImage.split('url("')[1].split('");')[0].split("&")[0],r=l.querySelector(".dcp-cars-buy-box__product-variation-name")?.textContent||l.querySelector('[data-test-id="dcp-cars-buy-box__product-variation-name"]')?.textContent||l.querySelector("h1")?.textContent||null,d="&imgt=P27&pov=BE030&im=Crop,rect=(240,260,1680,923);Resize,width=480",s=t.class,u={dcpProductLink:document.URL,dcpProductId:n,dcpProductImg:i+d,dcpProductVehicle:r,dcpProductClass:s,timestamp:c,expiration:30,target:!0},p={name:`${o}target_dcp_retargeting`,value:u},_=dataLayer_ow.find((e=>"pageview"===e.event&&1===e?.page?.products?.length))?.page.products;if(_&&_[0]){const e=_[0].id;u.dcpProductbm=e;const t={name:`${o}target_dcp_retargeting_${e}`,value:u};window.analytics_ow.personalisation.func.localStorage_set(t.name,t.value)}window.analytics_ow.personalisation.func.localStorage_set(p.name,p.value),""===o&&a("lastSeenPDP",p.value)}(),clearInterval(l))}),100)};window.location.pathname.indexOf("new-car/product.html")>-1&&"pageview"===e?o():window.location.pathname.indexOf("/new-car/search-results")>-1&&(()=>{const o=window.location.search.includes("new-commercial-vans")?"vans_":"",n=window.location.search;let c,l;if("vans_"!==o){const e=(e,t)=>{const a=new RegExp(`${t}=(.*?)(&|$)`),o=e.match(a);return o?o[1].replace(/%2C/g,",").replace(/_/g,"-"):null};c=e(n,"emhmodelIdentifier")||e(n,"model");const t=e(n,"emhbodyType"),a=e(n,"emhbrand");if(!c&&!t)return void localStorage.removeItem("target_dcp_last_model_filter");l={name:`${o}target_dcp_last_model_filter`,value:{dcp_last_modelfilter:c?.toLowerCase(),dcp_last_bodytypefilter:t?.toLowerCase(),dcp_last_brandfilter:a?.toLowerCase(),dcp_last_search_url:document.URL}}}else{if("pageview"===e?c=t.find((e=>["model","modelIdentifier"].includes(e.name)))?.value.toLowerCase().replace("_","-"):"click"===e&&void 0===t?(t=dataLayer_ow.find((e=>"pageview"===e.event&&e?.page.filter))?.page.filter,c=t.find((e=>["model","modelIdentifier"].includes(e.name)))?.value.toLowerCase().replace("_","-")):(t.includes("multiSelect|modelIdentifier|")||t.includes("multiSelect|model|"))&&(c=t.split("|")[2].toLowerCase().replace("_","-")),!c)return;l={name:`${o}target_dcp_last_model_filter`,value:{dcp_last_modelfilter:c?.toLowerCase(),dcp_last_search_url:document.URL}}}window.analytics_ow.personalisation.func.localStorage_set(l.name,l.value),""===o&&a("lastSRPModelFilter",l.value)})()};