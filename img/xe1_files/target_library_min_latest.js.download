window.analytics_ow=window.analytics_ow||{},window.analytics_ow.personalisation=window.analytics_ow.personalisation||{},window.analytics_ow.personalisation.globalvars=window.analytics_ow.personalisation.globalvars||{},window.analytics_ow.personalisation.globalvars.firedCampaign=window.analytics_ow.personalisation.globalvars.firedCampaign||{},window.analytics_ow.personalisation.func=window.analytics_ow.personalisation.func||{},window.analytics_ow.personalisation.templatecodes=window.analytics_ow.personalisation.templatecodes||{},window.analytics_ow.personalisation.func.find_all_by_key=(e,t)=>{if(e)return Object.entries(e).reduce(((e,[a,n],o)=>a===t?e.concat(n):"object"==typeof n&&"gtm.elementVisibility"!==n?.event?e.concat(window.analytics_ow.personalisation.func.find_all_by_key(n,t)):e),[])},window.analytics_ow.personalisation.func.find_value_by_event=(e,t,a)=>{if("object"==typeof e&&e.length>0)for(let n=0;n<e.length;n++)if(e[n].event===t)return analytics_ow.personalisation.func.find_all_by_key(e[n],a)[0]},window.analytics_ow.personalisation.func.setLocales=()=>{const{find_all_by_key:e}=window.analytics_ow.personalisation.func,{globalvars:t}=window.analytics_ow.personalisation;["market","language"].forEach((a=>{t[a]=e(dataLayer_ow,a)[0]}))},window.analytics_ow.personalisation.func.setVehicleInformation=()=>{const{find_all_by_key:e}=window.analytics_ow.personalisation.func,{globalvars:t}=window.analytics_ow.personalisation;["baumusterId","modelCode"].forEach((a=>{t[a.toLocaleLowerCase().replace("baumusterid","bm")]=e(dataLayer_ow,a)[0]}))},window.analytics_ow.personalisation.func.localStorage_check=()=>{const e=Date.now();Object.keys(localStorage).forEach((t=>{if(t.includes("target_")){const a=JSON.parse(localStorage.getItem(t));a&&a.expiration&&a.timestamp&&e>a.timestamp+1e3*a.expiration*60*60*24&&localStorage.removeItem(t)}}))},window.analytics_ow.personalisation.func.getStorageConsent=()=>{if(window.location.hostname.includes("antarctica")||"www.mercedes-benz.com.mx"===window.location.hostname)return!0;{const e=JSON.parse(localStorage.getItem("cmp_consents"))||{};return e.Personsalization_Component||e.Personalization_Component||false}},window.analytics_ow.personalisation.func.localStorage_set=(e,t,a=120)=>!!analytics_ow.personalisation.func.getStorageConsent()&&((t="string"==typeof t?JSON.parse(t):t).timestamp=t.timestamp||Date.now(),t.expiration=t.expiration||a,localStorage.setItem(e,JSON.stringify(t)),!0),window.analytics_ow.personalisation.func.sessionstorage_set=(e,t)=>!!(analytics_ow.personalisation.func.getStorageConsent()&&e&&t)&&(sessionStorage.setItem(e,"object"==typeof t?JSON.stringify(t):t),!0),window.analytics_ow.personalisation.func.check_storages=()=>{analytics_ow.personalisation.func.getStorageConsent()||setTimeout((()=>{["localStorage","sessionStorage"].forEach((e=>{let t=window[e];Object.keys(t).forEach((e=>{e.startsWith("target_")&&t.removeItem(e)}))}))}),1500)},analytics_ow.personalisation.func.getVMDSData_modelspecific=async(e,t=!1)=>{const a=e;let n=!1;if(!e.includes("-class")&&!t)try{if(!(e=await analytics_ow.personalisation.func.getVMDSData_modelmapping(e,!0)))return!1;e=e.classIds.classId,n=!0}catch(e){return console.log(`Error in getting VMDS data: ${e}`),!1}try{analytics_ow.personalisation.func.setLocales();const t=await fetch("https://api.oneweb.mercedes-benz.com/vmds-api/v1/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n            query classBodytypeVehicles($market: String!, $language: String!, $filter: String!) {\n              classBodytypeVehicles(market: $market, language: $language, filter: { classBodytype: { classId: $filter } }) {\n                 ccsClassId\n        classId\n        className\n        bodytypes {\n            models {\n                bm4\n                modelSeries\n                name\n                vehicles {\n                    images {\n                        cutouts {\n                            extraLarge\n                            large\n                            medium\n                            small\n                        }\n                        stage\n                    }\n                    subBrands\n                }\n                availableSubBrandsSets\n            }\n            bodytypeGroupId\n            bodytypeName\n            bodytypeId\n            ccsBodytypeId\n                }\n              }\n            }\n          ",variables:{market:analytics_ow.personalisation.globalvars.market,language:analytics_ow.personalisation.globalvars.language,filter:e}})}),{data:o}=await t.json();if(n){let e=o.classBodytypeVehicles[0]?.bodytypes.flatMap((e=>e.models)).find((e=>e?.modelSeries?.toLowerCase()===a.toLowerCase()||e?.modelSeries?.toLowerCase()===a.toLowerCase()+"-fl"||e?.modelSeries?.toLowerCase()===a.toLowerCase().replace("-fl","")));return e||!1}return o.classBodytypeVehicles}catch(e){return console.log(`Error in calling the API: ${e}`),!1}},analytics_ow.personalisation.func.getVMDSData_modelmapping=async(e,t)=>{let a=window.analytics_ow.personalisation.vehiclemapping;if(!a)try{const e=await fetch("https://api.oneweb.mercedes-benz.com/vmds-api/v1/vehicle-data-ids"),t=await e.json();window.analytics_ow.personalisation.vehiclemapping=t,a=t}catch(e){return console.log(`Error in calling the api: ${e}`),!1}const n=a.find((t=>t.bm4===e||t.modelSeries.toLowerCase()===e.toLowerCase()));return!!n&&(t?n:e===n.bm4?n.modelSeries:n.bm4)},analytics_ow.personalisation.func.getVehicleDeeplinks=async()=>{analytics_ow.personalisation.func.setLocales();const{market:e,language:t}=analytics_ow.personalisation.globalvars,a=`target_vehicle_deeplinks_${t}`;if(sessionStorage[a])return!0;if(e&&t)try{const n=`https://api.oneweb.mercedes-benz.com/vehicle-deeplinks-api/v1/deeplinks/${e}/${t}/model-series`,o=await fetch(n);if(!o.ok)throw new Error(`Error in calling the API: ${o.status}`);const i=await o.json();return window.analytics_ow.personalisation.func.sessionstorage_set(a,i),!0}catch(e){return console.error(`Error in calling the API: ${e}`),!1}},analytics_ow.personalisation.func.impressionTracking=(e,t,a)=>{const{type:n,campaign:o,format:i,experience:s,vehicle:r,trigger:c}=e;let l=t.trackingBlock?console.log:dataLayer_ow.push;n&&o&&i&&s&&""!==n&&""!==o&&""!==i&&""!==s||(console.log("Impression Tracking: Not all needed variables are set"),l=console.log),l({event:"click",eventDetail:{category:"impression",action:"Target",label:a,target:{experience:`${n}|${o}|${i}|${s}`,vehicle:r,trigger:c}},application:{id:"target",parentApplicationId:"aem"}})},analytics_ow.personalisation.func.clickTracking=(e,t,a)=>{const{type:n,campaign:o,format:i,experience:s,vehicle:r,trigger:c}=t;let l=a.trackingBlock?console.log:dataLayer_ow.push,d="unspecified";e.classList.forEach((t=>{t.includes("primary")||"primary"===e.getAttribute("variant")?d="primary":t.includes("secondary")||t.includes("wb-link")||"secondary"===e.getAttribute("variant")?d="secondary":t.includes("tertiary")&&(d="tertiary")})),e.addEventListener("click",(e=>{const t=e.target.textContent.toLowerCase().trim().replace(/\s/g,"_").replace(".","");n&&o&&i&&s&&""!==n&&""!==o&&""!==i&&""!==s||(console.log("Click Tracking: Not all needed variables are set"),l=console.log),l({event:"click",eventDetail:{category:"click",action:"Target",label:`${d}_${t}`,target:{experience:`${n}|${o}|${i}|${s}`,vehicle:r,trigger:c}},application:{id:"target",parentApplicationId:"aem"}})}))},analytics_ow.personalisation.func.sendEvergageData=(e,t,a,n)=>{let o=!1;"control"===t.experience&&(o=!0);const i={experienceId:e.experience,stat:a,control:o};if("true"===sessionStorage.sendEvent_disable_test||window.location.search.includes("evergageTestMessages")||Evergage.sendStat({campaignStats:[i]}),"Impression"===a)"true"===sessionStorage.sendEvent_disable_test||window.location.search.includes("evergageTestMessages")?console.log(`Evergage Action: ${t.campaign} - impression`):Evergage.sendEvent({action:`${t.campaign} - impression`});else{n.addEventListener("click",(function(e){e.target.textContent.toLowerCase().trim().replace(/\s/g,"_").replace(".","");"true"===sessionStorage.sendEvent_disable_test||window.location.search.includes("evergageTestMessages")?console.log(`Evergage Action: ${t.campaign} - click`):Evergage.sendEvent({action:`${t.campaign} - click`})}))}},analytics_ow.personalisation.func.stage_update=e=>{const t=document.querySelector("owc-stage:not([data-aem-targeting-hidden-initially])");if(!t)return;const a=analytics_ow.personalisation.func.getJSONData(t.getAttribute("component-id"))||"{}";e.cta={ctaDisplayMethod:"manual"};const n={...a,...e};window.top.seamlessStore.store.getConnection("OWC_PERSONALISATION_DATA").then((e=>{e.addPersonalisationData({componentId:t.getAttribute("component-id"),personalisationData:n})}))},analytics_ow.personalisation.func.simpleteaser_update=(e,t,a,n,o,i,s,r,c,l)=>{const d=Array.from(document.querySelectorAll("owc-simple-teaser")),p=[`[data-aem-targeting-use-case="${t}"]`,c&&`[data-aem-targeting-use-case-variant="${c}"]`,l&&`[data-aem-targeting-vehicle="${l}"]`].filter(Boolean).join(""),g=d.find((e=>!e.classList.contains("aem--is-hidden")&&(e.shadowRoot.querySelector(p)||e.querySelector(p))));if(g){let d=g.shadowRoot.querySelector(p)||g.querySelector(p);if(e)return d;{let e=analytics_ow.personalisation.func.getJSONData(d.getAttribute("component-id"))||"{}";const m={...e,headline:a||e.headline,copy:n||e.copy,image:o||e.image,links:i||e.links,tags:s||e.tags,bullets:r||e.bullets};m.personalization={hidden:"false",targetCampaign:t,targetUseCaseVariant:c,targetVehicle:l},window.top.seamlessStore.store.getConnection("OWC_PERSONALISATION_DATA").then((e=>{e.addPersonalisationData({componentId:d.getAttribute("component-id"),personalisationData:m}),d.classList.remove("aem--is-hidden");window.top.seamlessStore.initializeStore().getConnectionDispatchers("OWC_PERSONALISATION_DATA").then((e=>{"function"==typeof e.addItemsToShow&&(e.addItemsToShow({componentId:g.getAttribute("component-id"),itemsToShow:[d.getAttribute("component-id")]}),d=g.shadowRoot.querySelector(p)||g.querySelector(p))}),(e=>console.log(e)))}))}}},analytics_ow.personalisation.func.simple_price_teaser_update=(e,t,a,n)=>{let o=`sccs-simple-teaser-tile-with-price[data-aem-targeting-use-case="${e}"]`;t&&""!==t&&(o+=`[data-aem-targeting-vehicle="${t}"]`),a&&""!==a&&(o+=`[data-aem-targeting-use-case-variant="${a}"]`);let i=document.querySelector(o),s=analytics_ow.personalisation.func.getJSONData(i.getAttribute("component-id"))||"{}";if(i?.updateComponentConfigurationPayload)i.updateComponentConfigurationPayload(n.payload);else{var r=Object.assign({},s,n);window.top.seamlessStore.store.getConnection("OWC_PERSONALISATION_DATA").then((function(e){e.addPersonalisationData({componentId:i.getAttribute("component-id"),personalisationData:r.payload})}))}i.classList.remove("aem--is-hidden")},analytics_ow.personalisation.func.banner_teaser_update=(e,t,a,n)=>{let o=`owc-banner-teaser[data-aem-targeting-use-case="${e}"]`;t&&(o+=`[data-aem-targeting-vehicle="${t}"]`),a&&(o+=`[data-aem-targeting-use-case-variant="${a}"]`);const i=document.querySelector(o);if(!i)return;const s={...analytics_ow.personalisation.func.getJSONData(i.getAttribute("component-id"))||"{}",...n};window.top.seamlessStore.store.getConnection("OWC_PERSONALISATION_DATA").then((e=>{e.addPersonalisationData({componentId:i.getAttribute("component-id"),personalisationData:s}),i.classList.remove("aem--is-hidden")}))},analytics_ow.personalisation.func.textmediamodule_update=(e,t,a,n,o,i,s,r)=>{let c=`owc-text-media-module[data-aem-targeting-use-case="${t}"]`;s&&(c+=`[data-aem-targeting-use-case-variant="${s}"]`),r&&(c+=`[data-aem-targeting-vehicle="${r}"]`);const l=document.querySelector(c);if(e||!l?.personalisation)return l;{const e=analytics_ow.personalisation.func.getJSONData(l.getAttribute("component-id"))||"{}",t={...e,textBlock:{...e.textBlock,headline:a||e.textBlock.headline,description:n||e.textBlock.description,subtitle:o||e.textBlock.subtitle},buttonData:i||e.buttonData};window.top.seamlessStore.store.getConnection("OWC_PERSONALISATION_DATA").then((e=>{e.addPersonalisationData({componentId:l.getAttribute("component-id"),personalisationData:t}),l.classList.remove("aem--is-hidden")}))}},analytics_ow.personalisation.func.subNav_update=async e=>{const t=document.querySelector("owc-subnavigation");if(!t)return;const a=analytics_ow.personalisation.func.getJSONData(t.getAttribute("component-id"))||"{}";e.cta={ctaDisplayMethod:"manual"};const n={...a,...e};(await window.top.seamlessStore.store.getConnection("OWC_PERSONALISATION_DATA")).addPersonalisationData({componentId:t.getAttribute("component-id"),personalisationData:n})},analytics_ow.personalisation.func.pipage_cta_update=async(e,t)=>{const a=[];document.querySelector('[data-component-name="owpi-dynamic-stage-mvp"]')||a.push("owc-stage");const n=a.map((async e=>{const t=document.querySelector(e);if(null!==t){const e=analytics_ow.personalisation.func.getJSONData(t.getAttribute("component-id"))||"{}";if("manual"===e.cta.ctaDisplayMethod){e.cta={ctaDisplayMethod:"automate"};(await window.top.seamlessStore.store.getConnection("OWC_PERSONALISATION_DATA")).addPersonalisationData({componentId:t.getAttribute("component-id"),personalisationData:e})}}}));await Promise.all(n);const o=await window.top.seamlessStore.store.getConnection("OWC_VEHICLE_DATA");let i=setInterval((()=>{window.top.seamlessStore.store.store.getState().OWC_VEHICLE_DATA.cta.primary===e&&window.top.seamlessStore.store.store.getState().OWC_VEHICLE_DATA.cta.secondary===t?clearInterval(i):o.setCta({primary:e,secondary:t})}),250)},analytics_ow.personalisation.func.campaign_module_update=e=>{let t=analytics_ow.personalisation.globalvars.campaign_module||{};t?.update_block||(t.timer&&clearTimeout(t.timer),t.modules=t.modules||[],t.modules.push(e),t.timer=setTimeout((()=>{const e=document.querySelector('[data-component-name="hp-campaigns"]:not([data-aem-targeting-hidden-initially])');if(e){t.modules.sort(((e,t)=>e.prio-t.prio));for(let a=0;a<t.modules.length;a++)if(t.modules[a].image.toLowerCase().includes("pov=")){let n=t.modules[a].image.split("&")[0];t.modules[a].image=0===a?`${n}&IMGT=W27&POV=BE030&BKGND=9&im=Crop,rect=(300,500,1950,1750),gravity=Center;&crop=0,0,2150,1050`:`${n}&IMGT=W27&POV=BE030&BKGND=9&uni=m&imwidth=1650&imheight=2100&Resize,width=1550&crop=150,300,0,478&im=Crop,rect=(200,200,1600,1900)`,(window.innerWidth<1024||document.documentElement.clientWidth<1024||3===e?.querySelectorAll(".wb-grid-col-mq6-4")?.length)&&(t.modules[a].image=`${n}&IMGT=W27&POV=BE030&BKGND=9&uni=m&imwidth=1650&imheight=2100&Resize,width=1550&crop=150,300,0,478&im=Crop,rect=(200,200,1600,1900)`),t.modules[a].personalisationBg=!0}else t.modules[a].image.toLowerCase().includes("/bbd/images/")&&(t.modules[a].personalisationBg=!0);window.top.seamlessStore.store.getConnection("OWC_PERSONALISATION_DATA").then((a=>{a.addPersonalisationData({componentId:e.getAttribute("component-id"),personalisationData:t.modules})})),t.update_block=!0}}),750)),analytics_ow.personalisation.globalvars.campaign_module=t},analytics_ow.personalisation.func.getVehicleImage=async(e,t,a="none",n="stage",o=!1)=>{const i=await analytics_ow.personalisation.func.getVMDSData_modelspecific(e.toLowerCase(),o);if(!i)return;const s=i[0]?.bodytypes.find((e=>e.bodytypeId==t));if(!s)return!1;const r=s?.models[0]?.vehicles[0].images?.stage;if(!r)return!1;const c={simple_teaser:"&Resize,width=480",banner_teaser:"&Resize,width=960",stage:""}[n]||"";return"default"===a?r+c:"none"===a?r.split("&&BKGND=")[0]:r.split("&&BKGND=")[0]+a+c},analytics_ow.personalisation.func.get_pipage_stageimage=async(e,t)=>{const a=await fetch(e,{cache:"force-cache"}),n=await a.text(),o=document.createElement("div");o.innerHTML=n;const i=o.querySelector('link[media="(min-width: 1440px)"][as="image"]'),s=o.querySelector('[data-component-name="owpi-dynamic-stage-mvp"]'),r=s?.querySelector(".owpi-dynamic-stage-mvp__content img"),c=s?.querySelector(".owpi-stage-bg")?.querySelectorAll("source"),l=window.innerWidth||document.documentElement.clientWidth,d=Array.from(c||[]).find((e=>l>parseInt(e.getAttribute("media").split("width: ")[1].split("px")[0])))?.getAttribute("srcset");return i?i.getAttribute("href"):s&&r?t?{vehicle_image:r.src,vehicle_bg:d}:r.src:!(!s||r)&&o.querySelector('[property="og:image"]')?.getAttribute("content")},analytics_ow.personalisation.func.getJSONData=e=>(window.top.seamlessStore.store.subscribe("OWC_COMPONENT_REGISTRY",(({components:t})=>data=t[e])),data),analytics_ow.personalisation.func.getAffinityScoreData=()=>window.top.seamlessStore.store.store.getState().AFFINITY_SCORE,analytics_ow.personalisation.func.loadTemplateScript=async(e,t)=>{const a=document.createElement("script"),n=t?`/vans/${e}.js`:`/${e}.js`;return a.src=`https://assets.oneweb.mercedes-benz.com/plugin/ats-personalization/latest/template_codes_min${n}`,new Promise(((t,n)=>{a.onload=()=>t(!0),a.onerror=()=>n(new Error(`Script load error for ${e}`)),document.head.append(a)}))},analytics_ow.personalisation.func.setTrackingObject=(e,t,a)=>(a.type=e.Type,a.campaign=e.Campaign,a.experience=t,a.vehicle=e.Vehicle,a.trigger=e.Trigger,a),analytics_ow.personalisation.func.init_stage_buttons=(e,t)=>{const a=document.querySelector(".owpi-dynamic-stage-mvp, owc-stage:not([data-aem-targeting-hidden-initially])");(a?.shadowRoot?.querySelector(".owc-stage")||a).querySelectorAll(".wb-button, .owc-stage-cta-buttons__button").forEach((a=>{window.analytics_ow.personalisation.func.clickTracking(a,t,e),window.analytics_ow.personalisation.func.sendEvergageData(e,t,"Clickthrough",a)}))},analytics_ow.personalisation.template=class{constructor({tracking_object:e,target:t,control:a,experience_specific_methods:n,experience_specific_vars:o,track_on_init:i,dependancies:s={}}){this.tracking_object=e,this.experience_specific_methods=n,this.experience_specific_vars=o,this.dependancies=s;var r=this;this.debug=function(){var e={};Object.entries(r.dependancies).forEach((t=>{if("options"==t[0])for(var a=0;a<t[1].length;a++){var n=Object.entries(t[1][a]),o="OPTIONS_",i={exp:"",val:"",pass:""};n.forEach(((e,t)=>{var a=t==n.length-1,s=e[0];o+=a?s:s+"_OR_",i.exp+=a?e[1]?.exp:e[1]?.exp+",",i.val+=a?e[1]?.val:e[1]?.val+",",i.pass+=a?e[1]?.exp==e[1]?.val:(e[1]?.exp==e[1]?.val)+","})),e[o]=i}else{var s=t[0];e[s]={exp:t[1].exp,val:t[1].val,pass:t[1].exp==t[1].val}}})),console.table(e)},this.add_deps=function(e){return e.length>0?(r.dependancies.options=r.dependancies.options||[],r.dependancies.options.push(e[0])):r.dependancies={...r.dependancies,...e},r.dependancies},this.target=function(a,s,r,c,l){void 0===window.analytics_ow.personalisation.globalvars.firedCampaign[this.tracking_object.campaign]&&(window.analytics_ow.personalisation.globalvars.firedCampaign[this.tracking_object.campaign]=!0,i&&(window.analytics_ow.personalisation.func.impressionTracking(this.tracking_object,a,this.tracking_object.format+"_active"),window.analytics_ow.personalisation.func.sendEvergageData(a,this.tracking_object,"Impression")),t(a,n,o,e,this.add_deps))},this.control=function(t,s,r,c,l){void 0===window.analytics_ow.personalisation.globalvars.firedCampaign[this.tracking_object.campaign]&&(window.analytics_ow.personalisation.globalvars.firedCampaign[this.tracking_object.campaign]=!0,this.tracking_object.experience="control",i&&(window.analytics_ow.personalisation.func.impressionTracking(this.tracking_object,t,this.tracking_object.format+"_active"),window.analytics_ow.personalisation.func.sendEvergageData(t,this.tracking_object,"Impression")),a(t,n,o,e,this.add_deps))}}},setTimeout((function(){analytics_ow.personalisation.func.setLocales(),analytics_ow.personalisation.func.setVehicleInformation()}),500),analytics_ow.personalisation.func.setLocales(),analytics_ow.personalisation.func.localStorage_check(),analytics_ow.personalisation.func.check_storages();